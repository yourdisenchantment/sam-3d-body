#!/bin/bash

# Проверяем, передан ли аргумент (путь к папке)
if [ -z "$1" ]; then
    echo "Ошибка: Не указан путь к папке."
    echo "Использование: $0 /путь/к/проекту"
    exit 1
fi

TARGET_DIR="$1"
OUTPUT_FILE="code_dump.md"

# Проверяем, существует ли указанная папка
if [ ! -d "$TARGET_DIR" ]; then
    echo "Ошибка: Папка '$TARGET_DIR' не найдена."
    exit 1
fi

# Очищаем (или создаем) выходной файл перед началом
> "$OUTPUT_FILE"

echo "Начинаю сканирование папки: $TARGET_DIR"

# 1. find ищет все файлы (-type f) с расширением .py
# 2. sort сортирует их по алфавиту (опционально, но удобно)
# 3. while читает путь к каждому найденному файлу
find "$TARGET_DIR" -type f -name "*.py" | sort | while read -r filepath; do

    # Записываем заголовок с путем к файлу (добавляем ## для красоты Markdown)
    echo "## Файл: $filepath" >> "$OUTPUT_FILE"

    # Открываем блок кода (дописываем python для подсветки синтаксиса)
    echo '```python' >> "$OUTPUT_FILE"

    # Читаем содержимое файла и дописываем в выходной файл
    cat "$filepath" >> "$OUTPUT_FILE"

    # Закрываем блок кода (важно добавить перенос строки \n перед кавычками,
    # на случай если в файле нет пустой строки в конце)
    echo -e "\n\`\`\`" >> "$OUTPUT_FILE"

    # Добавляем пустые строки для разделения файлов
    echo -e "\n\n" >> "$OUTPUT_FILE"

    echo "Обработан: $filepath"
done

echo "Готово! Результат сохранен в файл: $OUTPUT_FILE"
